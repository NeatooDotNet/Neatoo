# Neatoo 0.8.0

**Release Date:** 2026-01-11
**Type:** Minor Release (New API)
**Breaking Changes:** None

---

## Summary

This release adds `Save(CancellationToken)` to the `IEntityBase` interface, enabling cancellation support for persistence operations. All samples and examples have been updated to demonstrate CancellationToken best practices.

---

## New API

### IEntityBase.Save(CancellationToken)

Added an overload that accepts a cancellation token:

```csharp
public interface IEntityBase : IValidateBase
{
    // Existing
    Task<IEntityBase> Save();

    // New in 0.8.0
    Task<IEntityBase> Save(CancellationToken token);
}
```

The implementation was already present in `EntityBase<T>`; this change exposes it on the public interface.

### Cancellation Behavior

Cancellation is checked before persistence operations begin. Once Insert, Update, or Delete starts executing, cancellation is not checked to avoid leaving the database in an inconsistent state.

---

## Dependencies

Updated to RemoteFactory 10.7.0, which fixes a bug where the generator created duplicate `Save`/`TrySave` methods when Insert, Update, and Delete all have CancellationToken parameters with different return types.

---

## Sample Updates

All async factory methods in `docs/samples/` now include CancellationToken parameters, demonstrating the recommended pattern:

```csharp
[Remote]
[Insert]
public async Task Insert([Service] IDbContext db, CancellationToken cancellationToken)
{
    await RunRules(token: cancellationToken);

    if (!IsSavable)
        return;

    db.Orders.Add(entity);
    await db.SaveChangesAsync(cancellationToken);
}
```

---

## Files Changed

- `src/Neatoo/EntityBase.cs` - Added `Save(CancellationToken)` to `IEntityBase` interface
- `Directory.Packages.props` - Updated RemoteFactory to 10.7.0
- `docs/samples/**` - Added CancellationToken to all async factory methods

---

## Migration Guide

**No action required.** The new method is additive. Existing code continues to work unchanged.

To adopt cancellation support:
1. Add `CancellationToken cancellationToken` parameter to your `[Fetch]`, `[Insert]`, `[Update]`, and `[Delete]` methods
2. Pass the token to `RunRules(token: cancellationToken)` and any async database operations
3. RemoteFactory will automatically propagate the token from client to server
