# Neatoo 0.6.0

**Release Date:** 2026-01-05
**Type:** Feature Release (Dependency Upgrade)
**Breaking Changes:** Yes (for custom IMakeRemoteDelegateRequest implementations)

---

## Summary

This release upgrades Neatoo.RemoteFactory from 10.1.1 to 10.5.0, bringing CancellationToken support for factory methods and ordinal-based JSON serialization for improved performance. The RemoteFactory upgrade enables better cancellation propagation through the client-server communication layer.

---

## What's New

### CancellationToken Support in Factory Methods

Factory methods generated by RemoteFactory now support `CancellationToken` for async operations. This enables proper cancellation propagation from client to server.

```csharp
// Factory methods now accept CancellationToken
var cts = new CancellationTokenSource();
cts.CancelAfter(TimeSpan.FromSeconds(30));

var employee = await employeeFactory.Fetch(employeeId, cts.Token);
```

### Ordinal Serialization

RemoteFactory 10.5.0 generates ordinal-based JSON converters for more compact serialization. Property values are serialized by position rather than name, reducing payload sizes for remote factory calls.

---

## Dependency Updates

| Package | Previous | New |
|---------|----------|-----|
| Neatoo.RemoteFactory | 10.1.1 | 10.5.0 |
| Neatoo.RemoteFactory.AspNetCore | 10.1.1 | 10.5.0 |

---

## Migration Guide

### For Application Developers Using IMakeRemoteDelegateRequest

If you implement `IMakeRemoteDelegateRequest` directly (typically for custom HTTP clients or testing), you must update the method signatures to include `CancellationToken`:

**Before (10.1.1):**
```csharp
public class CustomRemoteDelegateRequest : IMakeRemoteDelegateRequest
{
    public Task<T?> ForDelegate<T>(RemoteDelegateRequest request)
    {
        // Custom implementation
    }

    public Task<T?> ForDelegateNullable<T>(RemoteDelegateRequest request)
    {
        // Custom implementation
    }
}
```

**After (10.5.0):**
```csharp
public class CustomRemoteDelegateRequest : IMakeRemoteDelegateRequest
{
    public Task<T?> ForDelegate<T>(RemoteDelegateRequest request, CancellationToken cancellationToken)
    {
        // Custom implementation - pass cancellationToken to HTTP client
    }

    public Task<T?> ForDelegateNullable<T>(RemoteDelegateRequest request, CancellationToken cancellationToken)
    {
        // Custom implementation - pass cancellationToken to HTTP client
    }
}
```

### For Server-Side Endpoints

If you have custom server endpoints using `HandleRemoteDelegateRequest`, pass the `CancellationToken` from `HttpContext.RequestAborted`:

```csharp
app.MapPost("/api/remote", async (
    [FromBody] RemoteDelegateRequest request,
    [FromServices] IHandleRemoteDelegateRequest handler,
    HttpContext context) =>
{
    var result = await handler.HandleRemoteDelegateRequest(
        request,
        context.RequestAborted);  // Pass cancellation token
    return Results.Ok(result);
});
```

### For Standard Neatoo Usage

**No action required.** If you use Neatoo's built-in factory patterns without custom `IMakeRemoteDelegateRequest` implementations, the upgrade is transparent.

---

## API Changes

### IMakeRemoteDelegateRequest Interface

| Method | Change |
|--------|--------|
| `ForDelegate<T>` | Added `CancellationToken cancellationToken` parameter |
| `ForDelegateNullable<T>` | Added `CancellationToken cancellationToken` parameter |

### IHandleRemoteDelegateRequest Interface

| Method | Change |
|--------|--------|
| `HandleRemoteDelegateRequest` | Added `CancellationToken cancellationToken` parameter |

---

## RemoteFactory Changelog (10.1.1 to 10.5.0)

| Version | Feature |
|---------|---------|
| 10.2.0 | Ordinal serialization for compact JSON |
| 10.4.0 | CancellationToken support for async operations |
| 10.5.0 | Bug fix for race condition in cancellation tests |

---

## Test Results

All tests pass with the upgraded dependencies.

---

## Related Documentation

- [RemoteFactory Guide](../remote-factory.md) - Client-server communication patterns
- [Aggregates and Entities Guide](../aggregates-and-entities.md) - Factory method usage
- [v0.5.0 Release Notes](v0.5.0.md) - CancellationToken support in Neatoo core
