# Neatoo 10.4.0

**Release Date:** 2026-01-04
**Type:** Feature Release (Internal Refactoring)
**Breaking Changes:** No (internal only)

---

## Summary

This release collapses the "Base" layer from all Neatoo inheritance chains, making `ValidateBase<T>` the new foundation. This simplifies the framework architecture by eliminating an unused abstraction layer while maintaining full backward compatibility for all public APIs.

**Pattern change:** `Entity → Validate → Base` becomes `Entity → Validate`

---

## What's New

### Simplified Class Hierarchy

The inheritance chain has been flattened by merging the Base layer into the Validate layer:

**Before (10.3.x):**
```
Base<T>                    - Property management, INotifyPropertyChanged
  ValidateBase<T>          - Validation, rules engine
    EntityBase<T>          - Persistence awareness, modification tracking

ListBase<I>                - Observable collection
  ValidateListBase<I>      - Validation aggregation
    EntityListBase<I>      - DeletedList, persistence
```

**After (10.4.0):**
```
ValidateBase<T>            - Property management, INotifyPropertyChanged, validation, rules engine
    EntityBase<T>          - Persistence awareness, modification tracking

ValidateListBase<I>        - Observable collection, validation aggregation
    EntityListBase<I>      - DeletedList, persistence
```

### Consolidated Property Interfaces

The property interface hierarchy has been simplified:

**Before:**
```
IProperty                  - Value storage, busy tracking
  IValidateProperty        - Validation, messages
    IEntityProperty        - Modification tracking
```

**After:**
```
IValidateProperty          - Value storage, busy tracking, validation, messages
    IEntityProperty        - Modification tracking
```

### Consolidated Meta-Property Interfaces

**Before:**
```
IBaseMetaProperties        - IsBusy, WaitForTasks()
  IValidateMetaProperties  - IsValid, PropertyMessages, RunRules()
    IEntityMetaProperties  - IsModified, IsSavable, etc.
```

**After:**
```
IValidateMetaProperties    - IsBusy, WaitForTasks(), IsValid, PropertyMessages, RunRules()
    IEntityMetaProperties  - IsModified, IsSavable, etc.
```

### Updated Type References

| Before | After |
|--------|-------|
| `IBase` | `IValidateBase` |
| `IBase?` (Parent/Root) | `IValidateBase?` |
| `IProperty` | `IValidateProperty` |
| `IProperty<T>` | `IValidateProperty<T>` |
| `IPropertyManager<P>` | `IValidatePropertyManager<P>` |
| `IBaseMetaProperties` | `IValidateMetaProperties` |
| `IListBase` | `IValidateListBase` |
| `IListBase<I>` | `IValidateListBase<I>` |

---

## Motivation

The `Base<T>` and `ListBase<I>` classes existed as an abstraction layer for "property management without validation." In practice, this layer was never used directly:

1. **All user code** uses `ValidateBase<T>` or `EntityBase<T>` (with validation)
2. **No valid use case** exists for property management without validation
3. **Extra abstraction** added cognitive overhead without benefit
4. **Duplicate code** existed across Base and Validate layers

By collapsing this layer:
- Framework is easier to understand
- ~800 lines of duplicate code removed
- 8 source files deleted
- Fewer types for developers to navigate
- Simpler documentation

---

## Migration Guide

### For Application Developers

**No action required.** All public APIs remain unchanged. Your existing code using `ValidateBase<T>`, `EntityBase<T>`, `ValidateListBase<I>`, and `EntityListBase<I>` continues to work without modification.

### For Framework Extenders

If you have code that directly references internal Neatoo types, update as follows:

| Replace | With |
|---------|------|
| `Base<T>` | `ValidateBase<T>` |
| `ListBase<I>` | `ValidateListBase<I>` |
| `IBaseServices<T>` | `IValidateBaseServices<T>` |
| `Property<T>` | `ValidateProperty<T>` |
| `PropertyManager<P>` | `ValidatePropertyManager<P>` |

---

## Files Changed

### Deleted (8 source files)

| File | Merged Into |
|------|-------------|
| `src/Neatoo/Base.cs` | `ValidateBase.cs` |
| `src/Neatoo/ListBase.cs` | `ValidateListBase.cs` |
| `src/Neatoo/IBaseServices.cs` | `IValidateBaseServices.cs` |
| `src/Neatoo/Internal/BaseServices.cs` | `ValidateBaseServices.cs` |
| `src/Neatoo/IProperty.cs` | `IValidateProperty.cs` |
| `src/Neatoo/Internal/Property.cs` | `ValidateProperty.cs` |
| `src/Neatoo/IPropertyManager.cs` | `IValidatePropertyManager.cs` |
| `src/Neatoo/Internal/PropertyManager.cs` | `ValidatePropertyManager.cs` |

### Deleted (test files)

| File/Folder | Reason |
|-------------|--------|
| `src/Neatoo.UnitTest/Integration/Concepts/BaseClass/` | Entire folder - ValidateBase tests cover same functionality |
| `src/Neatoo.UnitTest/Unit/Core/PropertyTests.cs` | Merged into ValidateProperty tests |
| `src/Neatoo.UnitTest/Unit/Core/FatClientListBaseTests.cs` | Covered by ValidateListBase tests |

### Modified (core framework)

| File | Changes |
|------|---------|
| `src/Neatoo/ValidateBase.cs` | Absorbed all Base<T> functionality; made indexer public |
| `src/Neatoo/ValidateListBase.cs` | Absorbed all ListBase<I> functionality |
| `src/Neatoo/IValidateBaseServices.cs` | Absorbed IBaseServices members |
| `src/Neatoo/Internal/ValidateBaseServices.cs` | Absorbed BaseServices implementation |
| `src/Neatoo/IValidateProperty.cs` | Absorbed IProperty members |
| `src/Neatoo/Internal/ValidateProperty.cs` | Absorbed Property<T> implementation |
| `src/Neatoo/IValidatePropertyManager.cs` | Absorbed IPropertyManager members |
| `src/Neatoo/Internal/ValidatePropertyManager.cs` | Absorbed PropertyManager<P> implementation |
| `src/Neatoo/IMetaProperties.cs` | Removed IBaseMetaProperties; merged into IValidateMetaProperties |
| `src/Neatoo/InternalInterfaces.cs` | Removed IBaseInternal, IPropertyInternal |
| `src/Neatoo/Internal/IFactory.cs` | Removed CreateProperty method |
| `src/Neatoo/Internal/PropertyFactory.cs` | Removed CreateProperty method |
| `src/Neatoo/Internal/PropertyInfoList.cs` | Updated neatooTypes array (removed Base<>, ListBase<>) |
| `src/Neatoo.BaseGenerator/BaseGenerator.cs` | Changed to check for ValidateBase instead of Base |

### Modified (Blazor components)

All MudNeatoo components updated to use `IValidateProperty` instead of `IProperty`:

- `MudNeatooAutocomplete.razor.cs`
- `MudNeatooCheckBox.razor.cs`
- `MudNeatooDatePicker.razor.cs`
- `MudNeatooDateRangePicker.razor.cs`
- `MudNeatooNumericField.razor.cs`
- `MudNeatooRadioGroup.razor.cs`
- `MudNeatooSelect.razor.cs`
- `MudNeatooSwitch.razor.cs`
- `MudNeatooTextField.razor.cs`
- `MudNeatooTimePicker.razor.cs`
- `NeatooValidationSummary.razor.cs`

### Modified (test files)

| File | Changes |
|------|---------|
| `ValidatePropertyManagerTests.cs` | Updated interface references |
| `EntityPropertyManagerTests.cs` | Updated interface references |
| `ListBaseTests.cs` | Updated to use IValidateListBase |
| `DefaultFactoryTests.cs` | Removed CreateProperty tests |
| `BaseServicesTests.cs` | Removed PropertyManager references |
| `ValidateAsyncObject.cs` | Added using directive for Internal namespace |
| `PropertyMessageTests.cs` | Updated to use IValidateProperty |

### Modified (documentation)

| File | Changes |
|------|---------|
| `docs/aggregates-and-entities.md` | Updated hierarchy diagram |
| `docs/index.md` | Updated hierarchy diagram |
| `docs/collections.md` | Removed ListBase from hierarchy |
| `docs/property-system.md` | Merged IProperty into IValidateProperty documentation |
| `docs/meta-properties.md` | Merged IBaseMetaProperties into IValidateMetaProperties |

---

## Test Results

All 1,778 tests pass:
- Neatoo.UnitTest: 1,575 tests
- Neatoo.Blazor.MudNeatoo.UnitTest: 149 tests
- Neatoo.Documentation.Samples.Tests: 54 tests

---

## Dependencies

| Package | Version | Notes |
|---------|---------|-------|
| Neatoo.RemoteFactory | 10.1.1 | No changes required |

---

## Related Documentation

- [Aggregates and Entities Guide](../aggregates-and-entities.md) - Updated class hierarchy
- [Property System](../property-system.md) - Updated interface documentation
- [Meta-Properties Reference](../meta-properties.md) - Updated interface hierarchy
