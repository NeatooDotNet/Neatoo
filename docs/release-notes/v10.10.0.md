# Neatoo 10.10.0

**Release Date:** 2026-01-16
**Type:** Feature Release
**Breaking Changes:** Yes (source-level)

---

## Summary

Source-generated property backing fields replace string-based dictionary lookups. Properties now use strongly-typed `IValidateProperty<T>` backing fields with built-in lazy loading support.

---

## What's New

### Source-Generated Property Backing Fields

Properties no longer use `Getter<T>()`/`Setter()` with runtime dictionary lookups. The generator creates strongly-typed backing fields:

```csharp
// You write:
public partial string Name { get; set; }

// Generator creates:
protected IValidateProperty<string> NameProperty =>
    (IValidateProperty<string>)PropertyManager[nameof(Name)]!;

public partial string Name
{
    get => NameProperty.Value;
    set
    {
        NameProperty.Value = value;
        if (!NameProperty.Task.IsCompleted)
        {
            Parent?.AddChildTask(NameProperty.Task);
            RunningTasks.AddTask(NameProperty.Task);
        }
    }
}
```

### Lazy Loading Support

Configure lazy loading in the constructor via `OnLoad`:

```csharp
public Person(IEntityBaseServices<Person> services, IPhoneDbContext context)
    : base(services)
{
    PhonesProperty.OnLoad = async () =>
    {
        var phones = await context.LoadPhones(this.Id);
        return factory.Fetch(phones);
    };
}
```

Lazy loading is triggered on first property access. Load failures create broken rules on the property.

### ChangeReason for Property Events

`NeatooPropertyChangedEventArgs` now includes a `Reason` property:

```csharp
public enum ChangeReason
{
    Set,   // Normal property assignment
    Load   // LoadValue() or deserialization
}
```

Rules can check `eventArgs.Reason` to distinguish between user edits and data loading.

### NEATOO010 Analyzer

New analyzer warns when properties are assigned in constructors instead of using `LoadValue()`:

```csharp
// Warning NEATOO010: Use LoadValue() instead of direct assignment
public Person()
{
    Name = "Default";  // Warning
}

// Correct:
public Person()
{
    NameProperty.LoadValue("Default");  // No warning
}
```

---

## Breaking Changes

### Classes Must Be Partial

**All classes inheriting from `ValidateBase<T>` or `EntityBase<T>` must now be declared as `partial`.**

The source generator creates `InitializePropertyBackingFields()` which initializes property backing fields. Without `partial`, the generator cannot extend your class and properties will not function.

```csharp
// Required - class must be partial
[Factory]
internal partial class Person : EntityBase<Person>, IPerson { }

// Will NOT work - properties won't be initialized
[Factory]
internal class Person : EntityBase<Person>, IPerson { }  // Missing 'partial'
```

### Getter<T>/Setter Obsolete

`Getter<T>()` and `Setter()` are marked `[Obsolete]`. Update to partial property syntax:

**Before:**
```csharp
public string Name
{
    get => Getter<string>();
    set => Setter(value);
}
```

**After:**
```csharp
public partial string Name { get; set; }
```

### LoadValue Does Not Fire PropertyChanged

`LoadValue()` now fires `NeatooPropertyChanged` (internal) but not `PropertyChanged` (INotifyPropertyChanged). This prevents unnecessary UI updates during data loading. If you were relying on `PropertyChanged` during load, check your binding strategy.

---

## Migration Guide

1. **Ensure all entity classes are partial:**
   ```csharp
   // Add 'partial' keyword if missing
   [Factory]
   internal partial class Person : EntityBase<Person>, IPerson { }
   ```

2. **Convert properties to partial syntax:**
   ```csharp
   // Old
   public string Name
   {
       get => Getter<string>();
       set => Setter(value);
   }

   // New
   public partial string Name { get; set; }
   ```

3. **Update constructor assignments to LoadValue:**
   ```csharp
   // Old - causes IsModified = true
   Name = "Default";

   // New - keeps IsModified = false
   NameProperty.LoadValue("Default");
   ```

4. **Rebuild to regenerate backing fields**

---

## Related

- [Property Backing Fields Plan](../todos/property-backing-fields.md)
