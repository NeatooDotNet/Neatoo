# Neatoo 10.2.0

**Release Date:** 2026-01-02
**Type:** Feature Release
**Breaking Changes:** No

---

## Summary

This release separates public interfaces from internal framework coordination, making all public interfaces fully stubbable for unit testing with frameworks like KnockOff, Moq, and NSubstitute.

---

## What's Changed

### Internal Members Moved to Separate Interfaces

Previously, public interfaces like `IBase`, `IValidateBase`, and `IEntityBase` contained `internal` members that prevented external assemblies from implementing or stubbing them. These internal members have been moved to separate internal interfaces.

**Before:**
```csharp
public interface IBase
{
    IBase? Parent { get; }
    bool IsBusy { get; }
    Task WaitForTasks();
    internal void AddChildTask(Task task);           // Blocked stubbing
    internal IProperty GetProperty(string name);    // Blocked stubbing
    internal IPropertyManager<IProperty> PropertyManager { get; }  // Blocked stubbing
}
```

**After:**
```csharp
// Public interface - fully stubbable
public interface IBase
{
    IBase? Parent { get; }
    bool IsBusy { get; }
    Task WaitForTasks();
}

// Internal interface - framework coordination only
internal interface IBaseInternal
{
    void AddChildTask(Task task);
    IProperty GetProperty(string propertyName);
    IProperty this[string propertyName] { get; }
    IPropertyManager<IProperty> PropertyManager { get; }
}
```

### Affected Interfaces

| Public Interface | New Internal Interface | Members Moved |
|-----------------|------------------------|---------------|
| `IBase` | `IBaseInternal` | `AddChildTask`, `GetProperty`, indexer, `PropertyManager` |
| `IValidateBase` | `IValidateBaseInternal` | `ObjectInvalid` |
| `IEntityBase` | `IEntityBaseInternal` | `MarkModified`, `MarkAsChild` |
| `IProperty` | `IPropertyInternal` | `SetPrivateValue` |
| `IValidateProperty` | `IValidatePropertyInternal` | `SetMessagesForRule`, `ClearMessagesForRule`, `ClearAllMessages`, `ClearSelfMessages` |
| `IPropertyManager<P>` | `IPropertyManagerInternal<P>` | `PropertyInfoList`, `GetProperties` |
| `IEntityListBase` | `IEntityListBaseInternal` | `DeletedList` |
| `IRuleMessage` | `IRuleMessageInternal` | `RuleIndex` setter |

---

## Usage

### Creating Stubs for Unit Testing

You can now create stubs for Neatoo interfaces:

```csharp
// With KnockOff
[Stub]
public partial class StubEntityBase : IEntityBase { }

// With Moq
var mockEntity = new Mock<IEntityBase>();
mockEntity.Setup(e => e.IsValid).Returns(true);

// With NSubstitute
var entity = Substitute.For<IEntityBase>();
entity.IsValid.Returns(true);
```

---

## What's New

### Stubbable Public Interfaces

All public interfaces can now be implemented or stubbed by external assemblies:

- `IBase` - Core domain object contract
- `IValidateBase` - Validation contract
- `IEntityBase` - Entity/aggregate root contract
- `IProperty` / `IValidateProperty` / `IEntityProperty` - Property contracts
- `IPropertyManager<P>` - Property manager contract
- `IEntityListBase` / `IEntityListBase<I>` - Entity list contracts
- `IRuleMessage` - Validation message contract

### New Internal Interfaces

Framework coordination is now handled through internal interfaces in `InternalInterfaces.cs`:

- `IBaseInternal` - Task tracking, property access
- `IValidateBaseInternal` - Object-level validation state
- `IEntityBaseInternal` - Entity lifecycle management
- `IPropertyInternal` - Private value setting
- `IValidatePropertyInternal` - Rule message management
- `IPropertyManagerInternal<P>` - Property enumeration
- `IEntityListBaseInternal` - Deleted item tracking
- `IRuleMessageInternal` - Rule index assignment

---

## Files Changed

### New Files
- `src/Neatoo/InternalInterfaces.cs` - All internal interfaces

### Modified Core Files
- `src/Neatoo/Base.cs` - Implements `IBaseInternal`
- `src/Neatoo/ValidateBase.cs` - Implements `IValidateBaseInternal`
- `src/Neatoo/EntityBase.cs` - Implements `IEntityBaseInternal`
- `src/Neatoo/EntityListBase.cs` - Implements `IEntityListBaseInternal`
- `src/Neatoo/IProperty.cs` - Removed internal member
- `src/Neatoo/IValidateProperty.cs` - Removed internal members
- `src/Neatoo/IPropertyManager.cs` - Removed internal members
- `src/Neatoo/Rules/RuleMessage.cs` - Implements `IRuleMessageInternal`

### Modified Internal Files
- `src/Neatoo/Internal/Property.cs` - Implements `IPropertyInternal`
- `src/Neatoo/Internal/ValidateProperty.cs` - Implements `IValidatePropertyInternal`
- `src/Neatoo/Internal/PropertyManager.cs` - Implements `IPropertyManagerInternal<P>`
- `src/Neatoo/Rules/RuleManager.cs` - Casts to internal interfaces

---

## Dependencies

| Package | Version | Notes |
|---------|---------|-------|
| Neatoo.RemoteFactory | 10.1.1 | No changes |

---

## Related Documentation

- [Internal Interface Methods Analysis](../todos/internal-interface-methods-analysis.md)
- [Solution B Design Document](../todos/solution-b-internal-interfaces-design.md)
